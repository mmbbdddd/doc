### 大事记

2003 年，埃里克・埃文斯（Eric Evans）发表了具有里程碑意义的著作《领域驱动设计：软件核心复杂性应对之策》（Domain-Driven Design:
Tackling Complexity in the Heart of Software），正式提出了领域驱动设计的概念。

2006 年，吉米・尼尔森（Jimmy Nilsson）在他的著作《Applying Domain-Driven Design and Patterns: With Examples in C#
and.NET》中，将 DDD 和设计模式、重构等概念结合起来，进一步丰富了 DDD 的实践方法。

2007 年，格雷格・杨（Greg Young）提出了 CQRS（Command Query Responsibility Segregation）架构，将 DDD 的概念引入了架构设计，使得
DDD 可以更好地处理大型和复杂的系统。

2011 年，沃恩・弗农（Vaughn Vernon）在他的著作《Implementing Domain-Driven Design》中，进一步深化了 DDD 的实践方法，并提出了聚合设计的新方法。

## 我个人的理解
  
    我个人是从怀疑DDD，不相信DDD，自己在实践中总结经验去提升架构设计能力的路子中走过来的
    到19年左右的时候，经历了几个行业，实践的效果比较好，系统化总结以后发现我的理论几乎和DDD的非常相似。
    于是系统化的研究了DDD
      
    当时对DDD的关键质疑点是
    1，领域模型在所有领域都存在么？
    2，如果部分领域不存在，如何区分存在不存在领域的差别？
    3，如果存在，那如何确保领域模型对领域的所有变化都完备呢？————换言之，获取灵活的所有/大部分知识。
    4，聚合根和实体什么区别？

 
    1，DDD并没有回答如何获取全部的领域知识，
      但是在书中章节的最后，强调柔性设计和重构。这意味着DDD理论认为绝对的领域模型是不存在的，只存在相对的领域模型。
      但是DDD还提供了领域模型的完善手段，即事件风暴。这意味着你可以通过关键业务流程的归纳先获得一个并不成熟的领域模型，然后再通过多种方式反复论证它。
    2，在很多行业的实践中，最大的困难并不是领域模型有了以后如何开发落地。而是如何从繁杂的行业知识细节中归纳出领域模型。
      事件风暴是个方法，但是比如金融行业，我是对着会计法则事件风暴呢？还是对着市场格局和运营模式事件风暴呢？
      没有清晰目标的脑暴，解决不了任何问题。
      更没有办法指导更复杂的软件架构的清晰化和可靠设计。
      
      我突然理解到聚合根的含义：一颗大树，枝繁叶茂。但无论多么繁茂，都必然和毛细血管相连，而每个毛细血管，都通向根。
      聚合根是否是同样的意义呢？
      实际上，存在这样一个数据结构，它的字段和值就基本映射了软件的架构机构。

      比如 对一个支付系统，其实体为PayOrder，数据结构为
      class {
        Long buyer;
        Long saller;
        Long orderId;
        Bigdecimal amount;
        String payTool;//wx，alipay，cardno……
        String payChannel;//wx，alipay，unionpay，abc，……
      }
      那么，其系统内部必然有支付渠道系统，支付工具系统，这些系统内部有微信，支付宝，abc等不同支付渠道。

      我很迷惑————为何DDD这本书写的很模糊，含混，的作者不能直白的把这些东西说出来呢？只能归咎于他的职业是咨询师，姿色不能全漏，也不能不漏。

      
      
      实际上，从DDD的发展过程来看，他更像是一门不断完善和发展的理论。所以，从学习的态度上，我建议是从实践出发，带着自己对软件的判断来甄别他，验证他。
      
      尽量避免踩坑————毕竟，DDD诞生20年了，20年来，大半的软件公司和开发者都在实践他。但是大半的公司和开发者的软件质量依然很差。甚至很多用了DDD后
      更差的。

  
### 百度到的落地实践方法


**与领域专家紧密合作**
你需要积极与业务领域的专家进行沟通和交流，他们对业务流程、规则和概念有着深入的理解。通过与他们合作，可以确保你的软件设计准确地反映了业务需求。
定期组织研讨会、访谈等活动，让领域专家参与到软件设计的过程中，共同探讨和解决问题。

**建立统一语言**
在团队中建立一种统一的业务语言，避免因术语不一致而导致的误解。这种统一语言应该基于领域专家的术语和概念，同时也易于开发人员理解和使用。
将统一语言贯穿于需求分析、设计、开发和测试的各个阶段，确保团队成员之间的沟通顺畅

**明确业务边界**
通过分析业务领域，确定不同的业务模块和功能边界。每个限界上下文代表一个独立的业务领域，具有明确的职责和边界。
避免限界上下文之间的过度耦合，确保每个上下文都可以独立地进行开发、测试和维护
**设计上下文映射**
确定不同限界上下文之间的关系，设计合理的上下文映射。上下文映射可以帮助你理解不同业务模块之间的交互方式，以及如何在软件设计中实现这些交互。
常见的上下文映射方式有共享内核、客户 / 供应商、遵奉者等，根据实际情况选择合适的映射方式。

**确定聚合根**
在每个限界上下文中，确定一个或多个聚合根。聚合根是聚合的核心实体，它负责维护聚合的一致性和完整性。
聚合根应该具有明确的业务含义，并且能够代表整个聚合的状态。

**设计聚合结构**
围绕聚合根设计聚合的结构，包括实体、值对象和领域服务等。实体具有唯一的标识，值对象则是不可变的、用于描述领域概念的对象。
确保聚合内部的对象之间具有高内聚性，同时聚合之间保持低耦合性。

### 实践经验总结

* 1，和领域专家紧密合作/建立领域模型
  

     在一个领域专家和架构师的交流会上，就会计估值系统架构设计发生了以下对话。
     应用架构：我很疑惑，什么是会计？什么是估值？
     业务专家：以前叫会计，现在叫估值。会计更偏重流程，事后；估值更强调规划，事前。
     应用架构：那架构设计从哪里开始呢？
     业务专家：从会计基本知识入手
          分为资产，负债……再可以分为1234567……级别分类，分别有什么什么科目……这种科目这样，那种科目那样……
     领域专家：停停停~~~我们这样来分析。第一个问题是，估值系统的流程是什么
     业务专家：导入交易文件，然后核算，然后清算，然后台账，然后估值，然后估值确认。
     应用架构：文件有哪几种，做什么用处？
     业务专家：有dbf文件，有csv文件，有直接api的……形式比较灵活。总之，是各种交易数据。导入之后，作为估值表的输入
     应用架构：那核算呢？什么作用。
     业务专家：核算是为了确保数据的完整性和标准性，如果不完整，就获取；如果完整，但部分数据项有缺失，就补偿。总之，在下一个环节之前，这些事情必须处理掉。
     应用架构：那如果不完整，有无法获取；缺失，也无法补偿呢？
     业务专家：错误就停止
     应用架构：清算……
     业务专家：其实你反过来看比较容易，最终估值表都必须符合会计原则：有借有贷，借贷相等；而会计明细和交易明细并不是一一对应的，这个中间拆分处理的过程就
    是清分规则。
     应用架构,仔细看看了看估值表的结构，看到交易被划分为一个个小的会计凭证，组织在5级科目下，整体账目是严密平衡的树状架构。问道：那这个情分明细和这会计
     科目的映射关系在哪里配置呢？
     业务专家：会计准则表，这个是每个公司的核心机密，每种交易的科目，情分规则……都在这里。
    
    ………………


    大多数公司并不缺乏技术专家
    也并不缺乏业务专家。
    也并不缺乏让业务专家和技术专家一起紧密合作的空间和场所

    其实缺乏让他们一起有效合作，产生领域模型的具体工作方法。
    他们在一起，如果没有主题，一定是各聊各的；即使有主题，也不一定能聚焦到领域的关键点上，而可能比较发散。

    在领域模型的建立上，一定是架构师主导，以核心业务流程为核心，梳理流程步骤，梳理步骤能力词典，梳理关键利益相关方和诉求。
    进而抽象出领域模型的交易架构和能力词典。
 

* 2，建立统一语言~~
  
  
    应用架构：资产计算的时候，我+……
    业务专家：不对不对，如果是银行业，资产计算一般都是减。负债增加才是+
    应用架构：在交易发生的时候，我这个账户+
    业务专家：这个账户是会计科目账户，并不是资金账户，交易的时候并不会变化

    领域专家：stop，现在，我们梳理以下我们交易中，涉及到了哪些业务字段，这些字段的业务含义是什么，他们在业务发生的时候，运算关系是什么。


* 3，明确业务边界


    应用架构：文件导入是不是应该是基础架构部门负责的，他们应该出个通用组件来解决这个问题，去把基础架构的人叫过来……
    基础架构：文件内容是业务的，我们不涉及业务
    应用架构 ：配置化不是可以解耦么？
    基础架构：那你们先梳理出具体配置化需求…
    ,,,,,,,
    领域专家：stop，在需求分析阶段，只是分析阶段，只分析客户、价值、流程、业务词典；什么技术做，谁做不要讨论。

    应用架构：那，按照DDD理论中，所谓划分界限上下文，明确业务边界，明确的是什么？
    领域专家：明确的是流程本身的阶段。和具体组织架构，技术实现方式没有关系。
    应用架构：如果有一些能力，各个阶段都需要使用呢？
    领域专家：那各个阶段可以都分别列出来，也可以画成一个子模块，各阶段都使用。但实际实现层面，和这个没有关系————我们这个阶段只是流程上，逻辑上梳理清楚。

    

* 4，设计上下文映射
  

    应用专家：领域专家，不好了，之前流程上公用那个子模块，B系统他们现在的系统已经有了，但和我们现在的词典定义并不一样，他们并不愿意改造。
    领域专家，有两种方式解决这个问题
      1，他们适配我们
      2，我们适配他们
    不论是哪一种，都需要在系统中定义他们，我们，以及各个词典项的映射关系。


    应用专家：他们适配我们估计不太可能，我听说，他们系统架构比较糟糕，一动就挂，谁动谁死。我们会不会也有这个问题。
    
    领域专家：这就要看你了，如果你有能力将系统实现成微内核的。将来任何外部适配都不改动领域核心，只是外部做适配器或者配置。那随着几次迭代，一定是改动越来
    越少，稳定性越来越高。
    
      如果你的开发团队没有技术储备能实现这个架构，我建议你做成烟囱结构的，互相彼此不耦合；逻辑清晰，结构简单，隔离型号，实现和维护都很容易。


* 5，确定聚合根

    
    应用架构： 之前那个需求，我是按烟囱那个架构方案设计的，开发人员的确很容易理解和实现，质量也容易控制。但现在碰到了新问题，会计科目这块我们没有办法通过这种
    方式实现啊
      1，会计科目太多了
      2，平时配置变化频率太高了
    这种铺人的方式成本太高，而且不同科目之间，还有逻辑关系，开发人员沟通的准确性和一致性也不能每次都保证正确。我倾向于采用你说的第一种方式，可是我不明白支持
    这么灵活多变的会计设置的引擎前期应该怎么设计？

    领域专家：
      一棵大树，无论枝叶多么繁茂众多，每一个枝叶一定关联毛细血管，每一个毛细血管一定关联着根。
      在软件架构中，软件的逻辑分支无论多么复杂，都和输入请求的数据有密切关系。
      确定了这个数据结构，就确定了这个软件的输入架构。

      你要做会计引擎，你先去找3张会计准则表，分别是国家的，自己公司的，别的公司的。观察，归纳他们的数据结构和值。
      他们必然和你引擎的结构一一映射

      然后你找几个会计转专家，问他们各种会计科目的处理流程。梳理20个流程，同样观察归纳他们的流程结构。
      你引擎的处理流程必然是这些。————但即使是流程差异，也必然在会计科目上有标记，你注意观察这个关联标记在哪里，问清楚会计专家。

    ————
    这个数据结构对应用架构的决定性映射结构，就叫做聚合根。它一定程度上可以帮你处理，分析，控制复杂模块的架构设计。

    



* 7，值对象/实体对象/上下文


    应用架构：领域专家，我需要你帮我的团队做一次技术培训。虽然整体上，我觉得功能都实现了，可是，看起来代码可维护性却很差。
    领域专家：具体怎么个差劲法。
    应用专家：我们做金融行业的，以前是delipi+存储过程的——当然，公司里都是delphi开发；但这两年银行都微服务了，我们也必须跟着转型。
          我们根据自己的业务流程，导入，核算，清算，台账……7个步骤。分为7个子系统。每个子系统按照银行、基金、保险……分为5个孙系统，
           每个孙系统下，又根据特定的功能模块分析N个曾孙系统.......
    领域专家：很清晰，有什么问题
    应用专家：我们现在一个估值业务有200个子系统，800个研发，系统部署成本很高、性能很低、老是OOM、协作成本很高、响应业务很慢，但团队很累。
    
    领域专家：你们思路上是清晰的，架构划分原则也没什么错误。但是，你们不懂得最小复杂度原则。
      一段代码，能用一个对象实现的，你们用了一个系统。 
      能用本地队列的，你们引入了一个Rocket服务器，
      能用本地锁的，你们用了分布式锁。
      一段流程，能在一个系统内完成的，你们拆成了N个系统。
      ……
    
    正确的领域专家对你们架构落地的方式可能和你们现在的做法会不一样。
    针对你们的主业务核心，他可能一个类就能写完，无非就是一个模板方法
    GzService{
       fileload(ctx){};
       hs(ctx){};
       qs(ctx){};
        .....
    }
     ctx对象内是不同场景的配置和数据参数，中间的业务逻辑是根据特定的参数做参数解析和执行。
     这样算下来，核心大概一个主流程模板方法，几个子方法引擎组件研发，用来解析和执行配置和数据。
     剩下大部分业务方法，都是配置和扩展出来的，——————扩展的层次和结构和你们差异不会很大。
     差异很大的是系统的实现成本、运行成本、维护和扩展成本。




## 比较容易踩坑的地方
 
1，以为使用COLA，AXON、CQRS，EDA等所谓DDD框架就是在DDD。 
    1.1 使用了洋枪洋炮，不代表现代化@大清
    1.2  高手手中，C语言一样可以OO，低手使用OO，依然是过程式代码 
2，在PPT上拥抱DDD，聚合根，聚合，界限上下文……名词一堆， 没有落地为核心代码
    2.1 不能端到端落地，一切等于0
    2.2 不能用最简单的方式落地，接近于等于O 
      2.2.1 任何方式都能实现业务逻辑。而大家对DDD的定义并不清楚，如果仅以实现为验收。避免不要挂羊头卖狗肉。
      2.2.2 DDD理论上是复杂度最低的。  
          技术上：将纷繁复杂的业务复杂度(100),降低为领域复杂度（1）
          逻辑上：将纷繁复杂的逻辑变化复杂度（1）降低为0.1（聚合根）
          所以，它可以保持高度的清晰性、完整性、可控性。
      对复杂系统而言，是个混沌系统，局部的不确定性会被放大为无限。只有做到极致。



## 领域驱动实践关键踩点

1，分析设计阶段
    1.1是否以流程为核心梳理业务
    1.2是否抽象了交易角色
    1.3是否抽象了交易结构
    1.4是否梳理了业务词典
2，落地阶段  
    2.1领域核心层是否能覆盖所有流程
    2.2领域核心层是否能覆盖所有词典
    2.3领域核心层是否有IO和基础设施组件耦合
    2.4领域核心层是否有防腐层
    2.5领域核心层是否有单元测试
3，团队建设
    一个组织中，DDD如果要想长期保持，必须有利益岗位，有相应专业技能、有长期自发的、方向正确和反馈正向的动力来源。 
    3.1核心开发和业务开发角色划分（可以兼，但概念上必须区分）
    3.2核心开发业务学习和沟通培训
    3.3核心流程和架构抽象能力培训
    3.4核心开发复杂度识别分离能力培训
    3.4核心开发架构作图、设计培训
    
